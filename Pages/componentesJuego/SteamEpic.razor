@using FlaggGaming.Model.apiSteamJuego
@using FlaggGaming.Model.juegoFlagg
@inject FlaggGaming.Services.ServiciosAPISteam.JuegoSteamService servicioJuegoApiSteam

<div class="row">
    <div class="col mx-2">
        <div class="row border border-danger border-3 rounded">
            <div class="col-6 py-3 text-center">
                <img src="/imagenes/logoSteam.jpg" class="img-fluid" /> @*STEAM*@
            </div>
            <div class="col-3 my-auto">
                <div class="row p-2 mb-2">
                    <div class="col text-center rounded">
                        <a href="store.steampowered.com" class="btn btn-primary">U$D @precioSteamDolares.ToString()</a>
                    </div>
                </div>
                <div class="row p-2">
                    <div class="col text-center rounded">
                        <a href="store.steampowered.com" class="btn btn-primary">$ 10000</a>
                    </div>
                </div>
            </div>
        </div>
        <div class="row mt-3 border border-danger border-3 rounded">
            <div class="col-6 py-2 text-center">
                <img src="/imagenes/logoEpic.jpg" class="img-fluid" /> @*EPIC*@
            </div>
            <div class="col-3 my-auto">
                <div class="row p-2 mb-2">
                    <div class="col text-center"><a href="www.epicgames.com" class="btn btn-primary">U$D 15</a></div>
                </div>
                <div class="row p-2">
                    <div class="col text-center"><a href="www.epicgames.com" class="btn btn-primary">$ 15000</a></div>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    [Parameter] public JuegoFlagg unJuegoFlagg { get; set; }
    public Dictionary<string, JuegoSteam> juegoSteamApi;
    public decimal precioSteamDolares;
    public string idJuegoTienda;

    protected override async Task OnInitializedAsync()
    {
        idJuegoTienda = unJuegoFlagg.idJuegoTienda.ToString();
        juegoSteamApi = await servicioJuegoApiSteam.getJuegoSteam(idJuegoTienda);

        while (!juegoSteamApi.ContainsKey(idJuegoTienda))
        {
            Console.WriteLine("No se encontró la KEY en el DICCIONARIO del JUEGO. Se esperan 10 segundos para repetir el pedido de JUEGO a la API.");
            Thread.Sleep(10000);
            juegoSteamApi = await servicioJuegoApiSteam.getJuegoSteam(idJuegoTienda);
        }

        if (juegoSteamApi[idJuegoTienda].success)
        {
            if (juegoSteamApi[idJuegoTienda].data.price_overview != null)
            {
                precioSteamDolares = (decimal) juegoSteamApi[idJuegoTienda].data.price_overview.final / 100;
            }
        }
    }
}
